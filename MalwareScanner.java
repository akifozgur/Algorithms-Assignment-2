import java.io.IOException;
import java.util.Map;
import java.io.*;

public class MalwareScanner {

    private final Map<String, Malware> malwareDB;
    int countMalware=0;
    int countRow=0;

    public MalwareScanner(Map<String, Malware> malwareDB) {
        this.malwareDB = malwareDB;
    }

    public void scanFile(String filename) throws IOException {

        BufferedReader br = new BufferedReader(new FileReader(filename));
        BufferedWriter writer = new BufferedWriter(new FileWriter("scanLog.txt"));

        String st;
        while ((st = br.readLine()) != null) {
            countRow++;
            for (String malwareHash : malwareDB.keySet()){
                if (malwareHash.equals(turbo64(st))){
                    System.out.println("--------------------------------------------------------------------------------");
                    System.out.println("Detected malware!");
                    System.out.println(malwareDB.get(malwareHash).toString());
                    writer.write(malwareHash+"@"+countRow+"\n");
                    countMalware++;
                }
            }
        }
        writer.close();
        System.out.println("--------------------------------------------------------------------------------");
        System.out.println("Scan complete! "+countMalware+" threats are found and eliminated. Generating log file...");
        countMalware=0;
        countRow=0;
    }

    public static String turbo64(String in) {

        StringBuilder sb;

        long MOD_TURBO=4294967291L;
        long a=0;
        long b=1;
        for (int c : in.toCharArray()) {
            sb = new StringBuilder();
            sb.append((long)c);
            a = ((a + Long.valueOf(String.valueOf(sb)) % MOD_TURBO));
            b = ((a + b) % MOD_TURBO);
        }
        return Long.toHexString((b << 32) | a);
    }
}
